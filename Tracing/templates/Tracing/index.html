{% load static %}

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>Vehicle Tracer</title>
    <!--Bootstrap-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
      crossorigin="anonymous"
    />
    <!--Google Fonts-->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Ubuntu&display=swap"
      rel="stylesheet"
    />
    <!--Local CSS-->
    <link rel="stylesheet" href="{% static '/css/styles.css' %}" />
    <!--FontAwsome-->
    <script
      src="https://kit.fontawesome.com/e51e1b526a.js"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <section id="homepage">
      <div class="container-fluid">
        <!-- Nav Bar -->
        <nav class="navbar navbar-expand-lg navbar-dark">
          <!-- <div class="container-fluid"> -->
          <a class="navbar-brand" href="#">VehicleTracer</a>
          <button
            class="navbar-toggler ml-auto"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <i class="fas fa-bars navbar-toggler-icon fa-2x"></i>
          </button>
          <div
            class="collapse navbar-collapse justify-content-end"
            id="navbarSupportedContent"
          >
            <ul class="navbar-nav ml-auto">
              <li class="nav-item">
                <!-- Button trigger modal -->
                <a
                  class="nav-link"
                  data-bs-toggle="modal"
                  data-bs-target="#aboutModal"
                  href="#"
                  >About</a
                >
              </li>
            </ul>
          </div>
          <!-- </div> -->
        </nav>

        <!-- Title -->
        <div class="row">
          <div class="col-lg-6">
            <h1>Use security cameras of city to trace your vehicle.</h1>
            <form name="search" onsubmit="return tracePath()">
              <div class="form-floating mb-3 VehicleInput">
                <input
                  class="form-control"
                  id="floatingInput"
                  placeholder=" "
                  pattern="[A-Z0-9]{6,10}"
                  title="Must be 6-10 characters long"
                  required
                />
                <label for="floatingInput">Enter your Vehicle Number</label>
              </div>
              <button type="submit" class="btn btn-info btn-lg">
                Start Tracking
              </button>
            </form>
          </div>
          <div class="col-lg-6" id="homepageGraph">
            <img
              src="{% static '/images/homepageGraph.png' %}"
              alt="Graph Image"
            />
          </div>
        </div>
      </div>
    </section>

    <!-- tracker -->

    <section id="tracker" class="ratio ratio-16x9">
      <iframe
        id="iframeWithGraph"
        src="{% url 'camerasNetworkGraph' %}"
        frameborder="0"
        width="100%"
        height="100%"
        allow="fullscreen"
      ></iframe>
    </section>

    <!-- About - Modal -->

    <!-- Modal -->
    <div class="modal fade" id="aboutModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="aboutModal">About</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              style="margin-right: 5%"
            ></button>
          </div>
          <div class="modal-body container-fluid">
            <div class="myTeam">
              <h4>Mentor: &nbsp; Dr. Ranvijay Singh</h4>
              <br />
              <p>-Submitted By:</p>
              <div class="row">
                <div class="col-md-6 student">Harshit Garg (20184035)</div>
                <div class="col-md-6 student">Mradul Tiwari (20184125)</div>
                <div class="col-md-6 student">Mehul Rawal (20184142)</div>
                <div class="col-md-6 student">Kaustubh Gupta (20184166)</div>
              </div>
            </div>
            <hr />
            <div class="myContent">
              Some explaination goes here... <br />
              Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
              eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut
              enim ad minim veniam, quis nostrud exercitation ullamco laboris
              nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in
              reprehenderit in voluptate velit esse cillum dolore eu fugiat
              nulla pariatur. Excepteur sint occaecat cupidatat non proident,
              sunt in culpa qui officia deserunt mollit anim id est laborum.
              <br />
              Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
              eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut
              enim ad minim veniam, quis nostrud exercitation ullamco laboris
              nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in
              reprehenderit in voluptate velit esse cillum dolore eu fugiat
              nulla pariatur. Excepteur sint occaecat cupidatat non proident,
              sunt in culpa qui officia deserunt mollit anim id est laborum.
              <br />
              Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
              eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut
              enim ad minim veniam, quis nostrud exercitation ullamco laboris
              nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in
              reprehenderit in voluptate velit esse cillum dolore eu fugiat
              nulla pariatur. Excepteur sint occaecat cupidatat non proident,
              sunt in culpa qui officia deserunt mollit anim id est laborum.
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- BootStrap Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
      crossorigin="anonymous"
    ></script>
    <script src="{% static '/js/index.js' %}" charset="utf-8"></script>
  </body>
  <div id="loading">
    <img
      id="loading-image"
      src="{% static '/images/ajax-loader.gif' %}"
      alt="Loading..."
      class="center"
    />
  </div>
</html>

<script>
  window.onload = function () {
    $("#loading").hide();
  };

  function tracePath() {
    var licensePlateNumber = document.getElementById("floatingInput").value;
    var data = { licensePlateNumber: licensePlateNumber };

    // adding data to javascript form which is to be send over ajax request
    var formData = new FormData();
    formData.append("data", JSON.stringify(data));

    $("#loading").show();
    $.ajax({
      type: "POST",
      url: '{% url "getVehiclePath" %}',
      data: formData,
      dataType: "json",
      enctype: "multipart/form-data",
      processData: false,
      contentType: false,
      success: function (data) {
        $("#loading").hide();
        window.setTimeout(function () {
          document.getElementById("iframeWithGraph").scrollIntoView();
        }, 500);

        // checking and handling error conditions
        if (data.is_successful != "") {
          pathToVisualize = [];
          timestamp = [];
          for (var i = 0; i < data.vehiclePath.length; i++) {
            pathToVisualize.push(parseInt(data.vehiclePath[i][0]));
            var date = new Date(data.vehiclePath[i][1]).toString();
            timestamp.push(date.substr(0, date.length - 31));
          }

          var frames = window.frames;
          frames[0].location.reload();
          setTimeout(function () {
            window.parent.frames[0].vehiclePathFromParent(pathToVisualize, timestamp);
          }, 2000);
        } else {
          alert("Some unexpected error has occured. Try again.");
        }
      },
    });

    return false;
  }
</script>
